language: go

go:
  - 1.13.x
  - 1.14.x

services:
  - docker

env:
  global:
      # These dummy credentials are necessary for running tests against
      # localstack s3 service
    - AWS_ACCESS_KEY_ID=foo
    - AWS_SECRET_ACCESS_KEY=bar

before_install:
  - sudo pip install awscli
    # Start mock s3 service
  - docker run -d -p 4572:4566 -e SERVICES=s3 localstack/localstack
  - while ! curl http://localhost:4572; do sleep 1; done
  - sleep 5
    # Set up fixture S3 files
  - make fixture

script:
  - make cover # run test with coverage

after_success:
  - bash <(curl -s https://codecov.io/bash)
